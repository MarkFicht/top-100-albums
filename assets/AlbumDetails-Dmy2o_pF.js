import{d as I,r as i,c as _,o as L,u as M,a as y,b as f,w as a,e as T,f as d,g as v,h as s,i as n,j as P,k as u,t as c,n as E,l as A,m as G,_ as J}from"./index-BZFfNumW.js";const O={class:"mb-2"},Q={class:"text-grey-darken-1 mb-4"},q={class:"mb-1"},H={class:"mb-1"},K={class:"mb-1"},W={key:0,class:"text-caption text-grey-darken-1"},X=I({__name:"AlbumDetails",setup(Y){const $=T(),R=M(),o=i(null),p=i(""),w=i(!1),b=i(null),g=i(!0),m=i(null),x=i(!1),U=_(()=>{var t,e,l;return((l=(e=(t=o.value)==null?void 0:t["im:releaseDate"])==null?void 0:e.attributes)==null?void 0:l.label)??"Unknown"}),B=_(()=>{var t,e,l;return((l=(e=(t=o.value)==null?void 0:t.category)==null?void 0:e.attributes)==null?void 0:l.label)??"Unknown"}),D=_(()=>{var t,e;return((e=(t=o.value)==null?void 0:t["im:price"])==null?void 0:e.label)??"N/A"}),h=_(()=>{var t,e;return((e=(t=o.value)==null?void 0:t.rights)==null?void 0:e.label)??""}),S=()=>{try{const t=localStorage.getItem("albums");return t?JSON.parse(t).find(l=>l.id.attributes["im:id"]===$.params.id):null}catch(t){return console.error("‚ùå Failed to parse albums from localStorage",t),null}},V=async t=>{var e;try{const r=(e=(await(await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(t)}&limit=1`)).json()).results)==null?void 0:e[0];r!=null&&r.previewUrl?p.value=r.previewUrl:m.value="No song preview"}catch(l){console.error("üî¥ Preview fetch error",l),m.value="Error while downloading preview"}finally{g.value=!1}},j=async()=>{p.value&&(w.value=!0,await G(),b.value&&(b.value.src=p.value,b.value.play().catch(t=>{console.warn("üö´ Autoplay blocked:",t)})))};return L(async()=>{const t=S();if(!t)return m.value="Album not found in local storage.",R.replace({name:"NotFound"});o.value=t;const e=`${o.value["im:name"].label} ${o.value["im:artist"].label}`;await V(e)}),(t,e)=>{const l=d("v-btn"),C=d("v-img"),r=d("v-col"),k=d("v-row"),N=d("v-alert"),z=d("v-container");return o.value?(v(),y(z,{key:0,class:"pt-2 pt-md-5",role:"main"},{default:a(()=>[s(l,{class:"mb-4",variant:"outlined","data-cy":"back-button",color:"primary",size:"large","prepend-icon":"mdi-arrow-left",onClick:e[0]||(e[0]=P(F=>t.$router.back(),["prevent","stop"]))},{default:a(()=>e[2]||(e[2]=[u("Back")])),_:1}),n("h2",O,c(o.value["im:name"].label),1),n("p",Q,"by "+c(o.value["im:artist"].label),1),s(k,null,{default:a(()=>[s(r,{class:"mx-auto d-flex justify-center",cols:"12",md:"6"},{default:a(()=>[s(C,{class:E(["album-img",{loaded:x.value}]),src:o.value["im:image"][2].label,alt:`${o.value["im:name"].label} ‚Äî album cover`,"aspect-ratio":"1",cover:"",loading:"lazy","max-width":"320",onLoad:e[1]||(e[1]=F=>x.value=!0)},null,8,["src","alt","class"])]),_:1})]),_:1}),s(k,{class:"gy-2 mt-4"},{default:a(()=>[s(r,{cols:"12",sm:"6",md:"4"},{default:a(()=>[n("p",q,[e[3]||(e[3]=n("strong",null,"Release date:",-1)),u(" "+c(U.value),1)])]),_:1}),s(r,{cols:"12",sm:"6",md:"4"},{default:a(()=>[n("p",H,[e[4]||(e[4]=n("strong",null,"Genre:",-1)),u(" "+c(B.value),1)])]),_:1}),s(r,{cols:"12",sm:"6",md:"4"},{default:a(()=>[n("p",K,[e[5]||(e[5]=n("strong",null,"Price:",-1)),u(" "+c(D.value),1)])]),_:1}),s(r,{cols:"12",md:"12"},{default:a(()=>[h.value?(v(),A("p",W,c(h.value),1)):f("",!0)]),_:1})]),_:1}),s(l,{class:"mt-4",color:"primary",href:o.value.link.attributes.href,target:"_blank",rel:"noopener noreferrer"},{default:a(()=>e[6]||(e[6]=[u("View in Apple Music")])),_:1},8,["href"]),s(k,{class:"mt-5 justify-center"},{default:a(()=>[s(r,{cols:"12",md:"8",lg:"6"},{default:a(()=>[e[9]||(e[9]=n("h5",{class:"mb-3 text-center"},"Preview Track",-1)),g.value?(v(),y(N,{key:0,class:"mb-2",type:"info",density:"compact"},{default:a(()=>e[7]||(e[7]=[u("Loading preview...")])),_:1})):m.value?(v(),y(N,{key:1,class:"mb-2",type:"error",density:"compact"},{default:a(()=>[u(c(m.value),1)]),_:1})):f("",!0),!m.value&&p.value&&!w.value&&!g.value?(v(),y(l,{key:2,class:"mt-2 mb-4 mx-auto d-block",variant:"outlined",color:"primary",onClick:P(j,["prevent","stop"])},{default:a(()=>e[8]||(e[8]=[u("‚ñ∂Ô∏è Play preview")])),_:1})):f("",!0),p.value&&w.value?(v(),A("audio",{key:3,class:"d-block mx-auto",ref_key:"audioRef",ref:b,controls:"",preload:"none",style:{"max-width":"100%"}},null,512)):f("",!0)]),_:1})]),_:1})]),_:1})):f("",!0)}}}),ee=J(X,[["__scopeId","data-v-87b52e2e"]]);export{ee as default};
